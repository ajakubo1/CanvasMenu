CM={},CM.EVENTS={click:"click",mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove",mouseenter:"mouseenter",mouseleave:"mouseleave"},CM.Menu=function(t){var e=this;this.elements=[],this.canvas=t.canvas,this.width=t.width||800,this.height=t.height||600,this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.scaleX=1,this.scaleY=1,this.focused=void 0,this.animated=t.animation?!0:!1,this.running=!1,this.updateTime=void 0,this.tickLength=1e3/(t.fps||60),this.tickCount=0,this.tickMax=t.tickMax||Number.MAX_VALUE,this.autorescale=t.autorescale||!1,this.listener_mousedown=function(t){if(void 0!==e.focused){var i=(t.pageX-this.offsetLeft)/e.scaleX,s=(t.pageY-this.offsetTop)/e.scaleY;e.focused.trigger(CM.EVENTS.mousedown,i,s)}},this.listener_mousemove=function(t){var i,s=(t.pageX-this.offsetLeft)/e.scaleX,n=(t.pageY-this.offsetTop)/e.scaleY;if(void 0!==e.focused)e.focused.inRange(s,n)?e.focused.trigger(CM.EVENTS.mousemove,s,n):(e.focused.trigger(CM.EVENTS.mouseleave,s,n),e.focused=void 0);else for(i=0;i<e.elements.length;i+=1)if(e.elements[i].inRange(s,n)){e.focused=e.elements[i],e.focused.trigger(CM.EVENTS.mouseenter,s,n);break}},this.listener_mouseup=function(t){if(void 0!==e.focused){var i=(t.pageX-this.offsetLeft)/e.scaleX,s=(t.pageY-this.offsetTop)/e.scaleY;e.focused.trigger(CM.EVENTS.mouseup,i,s)}},this.rescale=function(){var t,i=window.getComputedStyle(e.canvas,null),s=i.getPropertyValue("-webkit-transform")||i.getPropertyValue("-moz-transform")||i.getPropertyValue("-ms-transform")||i.getPropertyValue("-o-transform")||i.getPropertyValue("transform")||void 0;"none"===s&&(s=e.canvas.style.transform,s=s.split(")")[0],s=s.split(","),s=s[0]+", 1, 1, "+s[1]+")"),s&&(t=s.split("(")[1],t=t.split(")")[0],t=t.split(","),e.scaleX=t[0],e.scaleY=t[3])},this.animationStep=t.animation,this.render=function(){var t;for(this.animated?this.animationStep(this.ctx):this.ctx.clearRect(0,0,this.width,this.height),t=0;t<this.elements.length;t+=1)this.ctx.drawImage(this.elements[t].getCanvas(),this.elements[t].getX(),this.elements[t].getY())},this.run=function(t){var i,s=Math.floor((t-e.updateTime)/e.tickLength);if(s>0){for(e.updateTime+=s*e.tickLength,e.tickCount+=s,e.tickCount>e.tickMax&&(e.tickCount=0),i=0;i<e.elements.length;i+=1)e.elements[i].update(e.tickCount);e.render()}e.running&&window.requestAnimationFrame(e.run)}},CM.Menu.prototype.isVisible=function(){return this.running},CM.Menu.prototype.init=function(){this.canvas.addEventListener("mouseup",this.listener_mouseup),this.canvas.addEventListener("mousedown",this.listener_mousedown),this.canvas.addEventListener("mousemove",this.listener_mousemove),this.render(),this.running=!0,this.autorescale&&(window.addEventListener("resize",this.rescale),this.rescale()),this.animated&&(this.updateTime=window.performance.now(),window.requestAnimationFrame(this.run))},CM.Menu.prototype.destroy=function(){var t;for(this.canvas.removeEventListener("mouseup",this.listener_mouseup),this.canvas.removeEventListener("mousedown",this.listener_mousedown),this.canvas.removeEventListener("mousemove",this.listener_mousemove),this.autorescale&&window.removeEventListener("resize",this.rescale),t=0;t<this.elements.length;t+=1)this.elements[t].destroy();this.render(),this.running=!1},CM.Menu.prototype.add=function(t){this.elements.push(t),t.setMenu(this)},CM.Menu.prototype.updateScale=function(t){this.scaleX=t,this.scaleY=t},CM.Menu.prototype.updateScaleX=function(t){this.scaleX=t},CM.Menu.prototype.updateScaleY=function(t){this.scaleY=t},CM.Menu.prototype.create=function(t,e){if(t=t.charAt(0).toUpperCase()+t.slice(1),CM[t]){var i=new CM[t](e);return this.add(i),i}throw new Error("Component of "+t+" type not found")},CM.Menu.prototype.forceRedraw=function(){this.animated||this.render()},CM.BUTTON_STATES={idle:"idle",over:"over",down:"down",up:"up"},CM.Element=function(t){if(this.name=t.name,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.x_limit=this.x+this.width,this.y_limit=this.y+this.height,this.value=void 0,this.tick=0,this.text=t.text,this.font=t.font||3*this.height/5+"pt Arial",this.align=t.align||"left",this.vertical=t.vertical||"middle",this.events={click:[],mousedown:[],mouseup:[],mousemove:[],mouseenter:[],mouseleave:[]},this["default"]="main",this.state="main",this.init_canvas=function(){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,t},this.canvas={main:this.init_canvas()},this["default"]={main:{font:"white"}},this.redrawStateField=function(t,e){},this.redrawStateText=function(e,i){var s=5,n=5;"center"===this.align?s=this.width/2:"right"===this.align&&(s=this.width-5),e.textBaseline="top","middle"===this.vertical?(e.textBaseline="middle",n=this.height/2):"bottom"===this.vertical&&(e.textBaseline="bottom",n=this.height),e.font=this.font,e.textAlign=this.align,e.fillStyle=t[i]?t[i].font||this["default"][i].font:this["default"][i].font,e.fillText(this.text,s,n)},this.redrawState=function(e){e=e||this.state;var i=this.canvas[e].getContext("2d");i.clearRect(0,0,this.width,this.height),t[e]&&t[e].fn?t[e].fn.call(this,i):this.redrawStateField(i,e),this.redrawStateText(i,e)},this.__down=void 0,this.__downListener=function(){this.__down=!0},this.__upListener=function(t,e){this.__down&&this.trigger(CM.EVENTS.click,t,e),this.__down=!1},this.__leaveListener=function(){this.__down=!1},t.on)for(var e=0;e<t.on.length;e+=1)this.on(t.on[e][0],t.on[e][1])},CM.Element.prototype.inRange=function(t,e){return t>=this.x&&t<=this.x_limit&&e>=this.y&&e<=this.y_limit?!0:!1},CM.Element.prototype.trigger=function(t,e,i){var s,n=this.events[t];for(s=0;s<n.length;s+=1)t===CM.EVENTS.click&&n[s]instanceof CM.Menu?(this.menu.destroy(),n[s].init()):n[s].call(this,e,i)},CM.Element.prototype.on=function(t,e){if(!(t in CM.EVENTS))throw new Error("Wrong Event! This library only allows for triggering the following events: "+Object.keys(CM.EVENTS));if(t===CM.EVENTS.click){if(e instanceof CM.Menu){var i;for(i=0;i<this.events[t].length;i+=1)if(this.events[t][i]instanceof CM.Menu)throw new Error("Duplicated Menu! You can't assign second Menu object to the same Button!")}void 0===this.__down&&(this.__down=!1,this.on(CM.EVENTS.mouseleave,this.__leaveListener),this.on(CM.EVENTS.mousedown,this.__downListener),this.on(CM.EVENTS.mouseup,this.__upListener))}this.events[t].push(e)},CM.Element.prototype.update=function(t){},CM.Element.prototype.getValue=function(){return this.value},CM.Element.prototype.getFormattedValue=function(){var t={};if(this.name)return t[this.name]=this.value,t},CM.Element.prototype.getX=function(){return this.x},CM.Element.prototype.getY=function(){return this.y},CM.Element.prototype.setMenu=function(t){this.menu=t},CM.Element.prototype.getCanvas=function(){return this.canvas[this.state]},CM.Element.prototype.destroy=function(){},CM.Button=function(t){CM.Element.call(this,t),this.state=CM.BUTTON_STATES.idle,this.align=t.align||"center",this["default"]={idle:{color:"green",font:"white"},over:{color:"blue",font:"white"},down:{color:"red",font:"white"},up:{color:"orange",font:"white"}},this.canvas={idle:this.init_canvas(),over:this.init_canvas(),down:this.init_canvas(),up:this.init_canvas()},this.redrawStateField=function(e,i){e.fillStyle=t[i]?t[i].color||this["default"][i].color:this["default"][i].color,e.fillRect(0,0,this.width,this.height)},this.redrawState(),this.redrawState(CM.BUTTON_STATES.over),this.redrawState(CM.BUTTON_STATES.down),this.redrawState(CM.BUTTON_STATES.up),this.enterListener=function(t,e){this.menu.canvas.style.cursor="pointer",this.state=CM.BUTTON_STATES.over,this.menu.forceRedraw()},this.leaveListener=function(t,e){this.menu.canvas.style.cursor="",this.state=CM.BUTTON_STATES.idle,this.menu.forceRedraw()},this.upListener=function(t,e){this.state=CM.BUTTON_STATES.up,this.menu.forceRedraw()},this.downListener=function(t,e){this.state=CM.BUTTON_STATES.down,this.menu.forceRedraw()},this.moveListener=function(t,e){this.state===CM.BUTTON_STATES.up&&(this.state=CM.BUTTON_STATES.over,this.menu.forceRedraw())},this.on(CM.EVENTS.mouseenter,this.enterListener),this.on(CM.EVENTS.mouseleave,this.leaveListener),this.on(CM.EVENTS.mousedown,this.downListener),this.on(CM.EVENTS.mouseup,this.upListener),this.on(CM.EVENTS.mousemove,this.moveListener)},CM.Button.prototype=Object.create(CM.Element.prototype),CM.Button.prototype.constructor=CM.Button,CM.Element.prototype.destroy=function(){this.state=CM.BUTTON_STATES.idle},CM.Element.prototype.update=function(t){this.tick=t,this.redrawState()},CM.Example=function(t){CM.Element.call(this,t)},CM.Example.prototype=Object.create(CM.Element.prototype),CM.Example.prototype.constructor=CM.Example,CM.Multiple=function(t){CM.Element.call(this,t),this.font=t.font||"20pt Arial",this.vertical=t.vertical||"top",this.elements=[],this.init=function(){if(t.elements){var e,i=40+this.y;for(e=0;e<t.elements.length;e+=1)this.elements.push(new CM.Switch({x:10+this.x,y:i-5+(5+t.template.height)*e,width:t.template.width,height:t.template.height,text:t.elements[e].text,name:t.elements[e].name,value:t.elements[e].value,on:t.elements[e].on}))}},this.init(),this.redrawStateField=function(t,e){t.strokeWidth=2,t.strokeStyle="white",t.strokeRect(0,0,this.width,this.height)},this.redrawState()},CM.Multiple.prototype=Object.create(CM.Element.prototype),CM.Multiple.prototype.constructor=CM.Multiple,CM.Multiple.prototype.setMenu=function(t){var e;for(this.menu=t,e=0;e<this.elements.length;e+=1)console.info(e),this.menu.add(this.elements[e])},CM.Radio=function(t){CM.Multiple.call(this,t)},CM.Radio.prototype=Object.create(CM.Multiple.prototype),CM.Radio.prototype.constructor=CM.Radio,CM.SWITCH_STATE={on:"on",off:"off"},CM.Switch=function(t){CM.Element.call(this,t),this["default"]={on:{inner:"white",outer:"white",font:"white"},off:{inner:"none",outer:"white",font:"white"}},this.canvas={on:this.init_canvas(),off:this.init_canvas()},this.value=t.value||!1,this.state=this.value?CM.SWITCH_STATE.on:CM.SWITCH_STATE.off,this.redrawStateField=function(e,i){var s;e.strokeStyle=t[i]?t[i].outer||this["default"][i].outer:this["default"][i].outer,e.strokeWidth=2,s="left"===this.align?this.width-4*this.height/5:this.height/5,e.strokeRect(s,this.height/5,3*this.height/5,3*this.height/5),"none"!==(t[i]?t[i].inner||this["default"][i].inner:this["default"][i].inner)&&(e.fillStyle=t[i]?t[i].inner||this["default"][i].inner:this["default"][i].inner,e.fillRect(s+3,this.height/5+3,3*this.height/5-6,3*this.height/5-6))},this.redrawState(CM.SWITCH_STATE.off),this.redrawState(CM.SWITCH_STATE.on),this.clickListener=function(t,e){this.value=!this.value,this.value?this.state=CM.SWITCH_STATE.on:this.state=CM.SWITCH_STATE.off,this.menu.forceRedraw()},this.on(CM.EVENTS.click,this.clickListener)},CM.Switch.prototype=Object.create(CM.Element.prototype),CM.Switch.prototype.constructor=CM.Example,CM.Switch.prototype.update=function(t){this.tick=t,this.redrawState()};
//# sourceMappingURL=dist/canvasmenu.map