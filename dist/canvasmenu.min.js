CM={},CM.Menu=function(t){var e=this;this.elements=[],this.canvas=t.canvas,this.width=t.width||800,this.height=t.height||600,this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.scaleX=1,this.scaleY=1,this.focused=void 0,this.animated=t.animation?!0:!1,this.running=!1,this.updateTime=void 0,this.tickLength=1e3/60,this.tickCount=0,this.tickMax=t.tickMax||Number.MAX_VALUE,this.autorescale=t.autorescale||!1,this.listener_mousedown=function(t){var i=(t.pageX-this.offsetLeft)/e.scaleX,n=(t.pageY-this.offsetTop)/e.scaleY;void 0!==e.focused&&e.focused.inRange(i,n)&&e.focused.trigger("mousedown",t)},this.listener_mousemove=function(t){var i,n=(t.pageX-this.offsetLeft)/e.scaleX,s=(t.pageY-this.offsetTop)/e.scaleY;if(void 0!==e.focused)e.focused.inRange(n,s)?e.focused.trigger("mousemove",t):(e.focused.trigger("mouseleave",t),e.focused=void 0);else for(i=0;i<e.elements.length;i+=1)if(e.elements[i].inRange(n,s)){e.focused=e.elements[i],e.focused.trigger("mouseenter",t);break}},this.listener_mouseup=function(t){var i=(t.pageX-this.offsetLeft)/e.scaleX,n=(t.pageY-this.offsetTop)/e.scaleY;void 0!==e.focused&&e.focused.inRange(i,n)&&e.focused.trigger("mouseup",t)},this.rescale=function(){var t,i=window.getComputedStyle(e.canvas,null),n=i.getPropertyValue("-webkit-transform")||i.getPropertyValue("-moz-transform")||i.getPropertyValue("-ms-transform")||i.getPropertyValue("-o-transform")||i.getPropertyValue("transform")||void 0;"none"===n&&(n=e.canvas.style.transform,n=n.split(")")[0],n=n.split(","),n=n[0]+", 1, 1, "+n[1]+")"),n&&(t=n.split("(")[1],t=t.split(")")[0],t=t.split(","),e.scaleX=t[0],e.scaleY=t[3])},this.redrawMenu=t.animation,this.run=function(t){if(e.running){var i,n=Math.floor((t-e.updateTime)/e.tickLength);if(n>0){for(e.updateTime+=n*e.tickLength,e.tickCount+=n,e.tickCount>e.tickMax&&(e.tickCount=0),i=0;i<e.elements.length;i+=1)e.elements[i].redraw(e.tickCount);e.redraw()}window.requestAnimationFrame(e.run)}}},CM.Menu.prototype.isVisible=function(){return this.running},CM.Menu.prototype.init=function(){this.canvas.addEventListener("mouseup",this.listener_mouseup),this.canvas.addEventListener("mousedown",this.listener_mousedown),this.canvas.addEventListener("mousemove",this.listener_mousemove),this.redraw(),this.running=!0,this.autorescale&&(window.addEventListener("resize",this.rescale),this.rescale()),this.animated&&(this.updateTime=window.performance.now(),window.requestAnimationFrame(this.run))},CM.Menu.prototype.destroy=function(){var t;for(this.canvas.removeEventListener("mouseup",this.listener_mouseup),this.canvas.removeEventListener("mousedown",this.listener_mousedown),this.canvas.removeEventListener("mousemove",this.listener_mousemove),this.autorescale&&window.removeEventListener("resize",this.rescale),t=0;t<this.elements.length;t+=1)this.elements[t].reinit();this.redraw(),this.running=!1},CM.Menu.prototype.add=function(t){this.elements.push(t),t.setMenu(this)},CM.Menu.prototype.updateScale=function(t){this.scaleX=t,this.scaleY=t},CM.Menu.prototype.updateScaleX=function(t){this.scaleX=t},CM.Menu.prototype.updateScaleY=function(t){this.scaleY=t},CM.Menu.prototype.create=function(t,e){if(t=t.charAt(0).toUpperCase()+t.slice(1),CM[t]){var i=new CM[t](e);return this.add(i),i}throw new Error("Component of "+t+" type not found")},CM.Menu.prototype.redraw=function(){var t;for(this.animated?this.redrawMenu(this.ctx):this.ctx.clearRect(0,0,this.width,this.height),t=0;t<this.elements.length;t+=1)this.ctx.drawImage(this.elements[t].getCanvas(),this.elements[t].getX(),this.elements[t].getY())},CM.ELEMENT_STATES={idle:"idle",over:"over",down:"down",up:"up"},CM.Element=function(t){if(this.name=t.name,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.x_limit=this.x+this.width,this.y_limit=this.y+this.height,this.value=void 0,this.tick=0,this.events={click:[],mousedown:[],mouseup:[],mousemove:[],mouseenter:[],mouseleave:[]},this["default"]="none",this.state="none",this.init_canvas=function(){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,t},this.canvas={none:this.init_canvas()},this.__down=void 0,this.__downListener=function(){this.__down=!0},this.__upListener=function(t){this.__down&&this.trigger("click",t),this.__down=!1},this.__leaveListener=function(){this.__down=!1},t.on)for(var e=0;e<t.on.length;e+=1)this.on(t.on[e][0],t.on[e][1])},CM.Element.prototype.inRange=function(t,e){return t>=this.x&&t<=this.x_limit&&e>=this.y&&e<=this.y_limit?!0:!1},CM.Element.prototype.trigger=function(t,e){var i,n=this.events[t];for(i=0;i<n.length;i+=1)"click"===t&&n[i]instanceof CM.Menu?(this.menu.destroy(),n[i].init()):n[i].call(this,e)},CM.Element.prototype.on=function(t,e){if(!(t in this.events))throw new Error("Wrong Event! This library only allows for triggering the following events: "+Object.keys(this.events));if("click"===t){if(e instanceof CM.Menu){var i;for(i=0;i<this.events[t].length;i+=1)if(this.events[t][i]instanceof CM.Menu)throw new Error("Duplicated Menu! You can't assign second Menu object to the same Button!")}void 0===this.__down&&(this.__down=!1,this.on("mouseleave",this.__leaveListener),this.on("mousedown",this.__downListener),this.on("mouseup",this.__upListener))}this.events[t].push(e)},CM.Element.prototype.redraw=function(t){},CM.Element.prototype.getValue=function(){return this.value},CM.Element.prototype.getFormattedValue=function(){var t={};return t[this.name]=this.value,t},CM.Element.prototype.getX=function(){return this.x},CM.Element.prototype.getY=function(){return this.y},CM.Element.prototype.setMenu=function(t){this.menu=t},CM.Element.prototype.getCanvas=function(){return this.canvas[this.state]},CM.Element.prototype.getState=function(){return this.state},CM.Element.prototype.reinit=function(){},CM.Button=function(t){CM.Element.call(this,t),this.state=CM.ELEMENT_STATES.idle,this.text=t.text,this.font=t.font||3*this.height/5+"pt Arial",this["default"]={idle:{color:"green",font:"white"},over:{color:"blue",font:"white"},down:{color:"red",font:"white"},up:{color:"orange",font:"white"}},this.canvas={idle:this.init_canvas(),over:this.init_canvas(),down:this.init_canvas(),up:this.init_canvas()},this.internalRedraw=function(e){e=e||this.state;var i=this.canvas[e].getContext("2d");i.clearRect(0,0,this.width,this.height),t[e]&&t[e].fn?t[e].fn.call(this,i):(i.fillStyle=t[e]?t[e].color||this["default"][e].color:this["default"][e].color,i.fillRect(0,0,this.width,this.height)),i.font=this.font,i.textAlign="center",i.textBaseline="middle",i.fillStyle=t[e]?t[e].font||this["default"][e].font:this["default"][e].font,i.fillText(this.text,this.width/2,this.height/2)},this.internalRedraw(),this.internalRedraw(CM.ELEMENT_STATES.over),this.internalRedraw(CM.ELEMENT_STATES.down),this.internalRedraw(CM.ELEMENT_STATES.up),this.enterListener=function(t){this.menu.canvas.style.cursor="pointer",this.state=CM.ELEMENT_STATES.over,this.menu.redraw()},this.leaveListener=function(t){this.menu.canvas.style.cursor="",this.state=CM.ELEMENT_STATES.idle,this.menu.redraw()},this.upListener=function(t){this.state=CM.ELEMENT_STATES.up,this.menu.redraw()},this.downListener=function(t){this.state=CM.ELEMENT_STATES.down,this.menu.redraw()},this.moveListener=function(t){this.state===CM.ELEMENT_STATES.up&&(this.state=CM.ELEMENT_STATES.over,this.menu.redraw())},this.on("mouseenter",this.enterListener),this.on("mouseleave",this.leaveListener),this.on("mousedown",this.downListener),this.on("mouseup",this.upListener),this.on("mousemove",this.moveListener)},CM.Button.prototype=Object.create(CM.Element.prototype),CM.Button.prototype.constructor=CM.Button,CM.Element.prototype.reinit=function(){this.state=CM.ELEMENT_STATES.idle},CM.Element.prototype.redraw=function(t){this.tick=t,this.internalRedraw()},CM.Example=function(t){CM.Element.call(this,t)},CM.Example.prototype=Object.create(CM.Element.prototype),CM.Example.prototype.constructor=CM.Example;
//# sourceMappingURL=dist/canvasmenu.map