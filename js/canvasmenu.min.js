function Menu(c,d,a,e){var b=this;this.buttons=[];this.canvas=c;this.width=d;this.height=a;this.canvas.width=d;this.canvas.height=a;this.ctx=c.getContext("2d");this.scaleX=1;this.scaleY=1;this.focused=undefined;this.animated=e?true:false;this.running=false;this.updateTime=undefined;this.tickLength=16.66666666;this.tickCount=0;this.tickMax=60;this.listener_mousedown=function(h){var g,f=h.pageX*b.scaleX-this.offsetLeft,j=h.pageY*b.scaleY-this.offsetTop;if(b.focused.inRange(f,j)){b.focused.setState(BUTTON_ENUM.down);b.focused.redrawBackground(b.tickCount);if(!b.animated){b.redrawButtons()}}};this.listener_mousemove=function(h){var g,f=h.pageX*b.scaleX-this.offsetLeft,j=h.pageY*b.scaleY-this.offsetTop;if(b.focused!==undefined){if(!b.focused.inRange(f,j)){b.focused.setState(BUTTON_ENUM.inactive);b.focused=undefined;if(!b.animated){b.redrawButtons()}}}for(g=0;g<b.buttons.length;g+=1){if(b.buttons[g].inRange(f,j)){b.focused=b.buttons[g];b.buttons[g].setState(BUTTON_ENUM.focused);if(!b.animated){b.redrawButtons()}break}}};this.listener_mouseup=function(h){var g,f=h.pageX*b.scaleX-this.offsetLeft,j=h.pageY*b.scaleY-this.offsetTop;if(b.focused.inRange(f,j)){b.focused.setState(BUTTON_ENUM.up);if(!b.animated){b.redrawButtons()}b.focused.click();b.focused.redrawBackground(b.tickCount)}};this.redrawButtons=function(){var f;if(this.animated){this.redrawBackground()}else{this.ctx.clearRect(0,0,c.width,c.height)}for(f=0;f<this.buttons.length;f+=1){this.ctx.drawImage(this.buttons[f].getCanvas(),this.buttons[f].getX(),this.buttons[f].getY())}};this.redrawBackground=e;this.run=function(h){if(b.running){var f=Math.floor((h-b.updateTime)/b.tickLength),g;if(f>0){b.updateTime+=f*b.tickLength;b.tickCount+=f;if(b.tickCount>b.tickMax){b.tickCount=0}for(g=0;g<b.buttons.length;g+=1){b.buttons[g].redrawBackground(b.tickCount)}b.redrawButtons()}window.requestAnimationFrame(b.run)}}}Menu.prototype.init=function(){this.canvas.addEventListener("mouseup",this.listener_mouseup);this.canvas.addEventListener("mousedown",this.listener_mousedown);this.canvas.addEventListener("mousemove",this.listener_mousemove);this.redrawButtons();this.running=true;if(this.animated){this.updateTime=window.performance.now();window.requestAnimationFrame(this.run)}};Menu.prototype.destroy=function(){var a;this.canvas.removeEventListener("mouseup",this.listener_mouseup);this.canvas.removeEventListener("mousedown",this.listener_mousedown);this.canvas.removeEventListener("mousemove",this.listener_mousemove);for(a=0;a<this.buttons.length;a+=1){this.buttons[a].setState(BUTTON_ENUM.inactive);this.redrawButtons()}this.running=false};Menu.prototype.appendButton=function(a){this.buttons.push(a);a.setParentMenu(this)};var BUTTON_ENUM={inactive:0,focused:1,down:2,up:3};function Button(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height;this.x_limit=this.x+this.width;this.y_limit=this.y+this.height;this.state=BUTTON_ENUM.inactive;this.canvas_inactive=document.createElement("canvas");this.canvas_inactive.width=this.width;this.canvas_inactive.height=this.height;this.tick=0;this.text=a.text;this.canvas_focused=document.createElement("canvas");this.canvas_focused.width=this.width;this.canvas_focused.height=this.height;this.canvas_down=document.createElement("canvas");this.canvas_down.width=this.width;this.canvas_down.height=this.height;this.canvas_up=document.createElement("canvas");this.canvas_up.width=this.width;this.canvas_up.height=this.height;this.redraw=function(){if(this.state===BUTTON_ENUM.inactive){this.redrawInactive()}else{if(this.state===BUTTON_ENUM.focused){this.redrawFocused()}else{if(this.state===BUTTON_ENUM.down){this.redrawDown()}else{if(this.state===BUTTON_ENUM.up){this.redrawUp()}}}}};this.redrawInactive=function(){var b=this.canvas_inactive.getContext("2d");b.clearRect(0,0,this.width,this.height);if(a.redrawInactive){a.redrawInactive.call(this,b)}else{b.fillStyle=a.redrawInactiveColor||"green";b.fillRect(0,0,this.width,this.height);b.font="30pt Arial";b.textAlign="center";b.fillStyle="white"}b.fillText(this.text,this.width/2,(this.height-30)/2+30)};this.redrawInactive();this.redrawFocused=function(){var b=this.canvas_focused.getContext("2d");b.clearRect(0,0,this.width,this.height);if(a.redrawFocused){a.redrawFocused.call(this,b)}else{b.fillStyle=a.redrawFocusedColor||"blue";b.fillRect(0,0,this.width,this.height);b.font="30pt Arial";b.textAlign="center";b.fillStyle="white"}b.fillText(this.text,this.width/2,(this.height-30)/2+30)};this.redrawFocused();this.redrawDown=function(){var b=this.canvas_down.getContext("2d");b.clearRect(0,0,this.width,this.height);if(a.redrawDown){a.redrawDown.call(this,b)}else{b.fillStyle=a.redrawDownColor||"red";b.fillRect(0,0,this.width,this.height);b.font="30pt Arial";b.textAlign="center";b.fillStyle="white"}b.fillText(this.text,this.width/2,(this.height-30)/2+30)};this.redrawDown();this.redrawUp=function(){var b=this.canvas_up.getContext("2d");b.clearRect(0,0,this.width,this.height);if(a.redrawUp){a.redrawUp.call(this,b)}else{b.fillStyle=a.redrawUpColor||"orange";b.fillRect(0,0,this.width,this.height);b.font="30pt Arial";b.textAlign="center";b.fillStyle="black"}b.fillText(this.text,this.width/2,(this.height-30)/2+30)};this.redrawUp()}Button.prototype.inRange=function(a,b){if(a>=this.x&&a<=this.x_limit&&b>=this.y&&b<=this.y_limit){return true}return false};Button.prototype.setState=function(a){this.state=a;this.tick=0};Button.prototype.redrawBackground=function(a){this.tick=a;this.redraw()};Button.prototype.getCanvas=function(){if(this.state===BUTTON_ENUM.inactive){return this.canvas_inactive}else{if(this.state===BUTTON_ENUM.focused){return this.canvas_focused}else{if(this.state===BUTTON_ENUM.down){return this.canvas_down}else{if(this.state===BUTTON_ENUM.up){return this.canvas_up}}}}};Button.prototype.getX=function(){return this.x};Button.prototype.getY=function(){return this.y};Button.prototype.setParentMenu=function(a){this.menu=a};Button.prototype.clickHandler=function(a){this.onclick=a};Button.prototype.click=function(){if(this.onclick instanceof Menu){this.menu.destroy();this.onclick.init()}else{if(this.onclick!==undefined){this.onclick.call()}}};